{"version":3,"file":"location-picker.js","sources":["components/location-picker.vue","C:/Users/ctwl/Desktop/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovZGVtby91bmlhcHBfc2hhcmUvbWlucHJvZ3JhbV9zaGFyZS9jb21wb25lbnRzL2xvY2F0aW9uLXBpY2tlci52dWU"],"sourcesContent":["\r\n<template>\n  <view class=\"location-picker\" @tap=\"chooseLocation\">\n    <van-cell :disabled=\"disabled\">\n      <template #title>\n        <view class=\"location-content\">\n          <van-icon \n            v-if=\"showIcon !== false\" \n            name=\"location-o\" \n            size=\"32rpx\" \n            color=\"#e94359\" \n            class=\"location-icon\"\n          />\n          <text class=\"location-text\">{{ currentAddress || (placeholder || '选择位置') }}</text>\n        </view>\n      </template>\n      <template #right-icon>\n        <view v-if=\"isLoading\" class=\"loading-icon\">\n          <van-loading type=\"spinner\" size=\"20rpx\" color=\"#999\" />\n        </view>\n        <van-icon v-else name=\"arrow\" size=\"28rpx\" color=\"#999\" />\n      </template>\n    </van-cell>\n  </view>\n</template>\n\r\n<script setup lang=\"ts\">\nimport { ref, onMounted } from 'vue';\n\n// Props定义\nconst props = defineProps<{\n  showIcon?: boolean;\n  placeholder?: string;\n  disabled?: boolean;\n}>();\n\n// Emits定义\nconst emit = defineEmits<{\n  'change': [address: string, location: { latitude: number; longitude: number }];\n}>();\n\n// 响应式数据\nconst currentAddress = ref('定位中...');\nconst location = ref<{ latitude: number; longitude: number }>({\n  latitude: 0,\n  longitude: 0\n});\nconst isLoading = ref(false);\n\nconst handleLocation = async () => {\n  if (props.disabled || isLoading.value) return;\n  \n  isLoading.value = true;\n  try {\n    // 获取位置信息\n    uni.getLocation({\n      type: 'gcj02',\r\n\t  highAccuracyExpireTime:3000,\r\n\t  isHighAccuracy:true,\r\n      success: async (res) => {\n        const { latitude, longitude } = res;\n        uni.request({\n          url: 'https://restapi.amap.com/v3/geocode/regeo',\n          method: 'GET',\n          data: {\n            key: 'fdcbd1a63fa5fe1b64ac5b53de5ebb78', // 、高德地图key\n            location: `${longitude},${latitude}`,\n            extensions: 'base',\n            s: 'rsx',\n            sdkversion: 'sdkVERSION'\n          },\n          success: (geoRes: any) => {\n            let address = '';\r\n\t\t\tuni.__f__('log','at components/location-picker.vue:74',geoRes)\r\n            if (geoRes.data && geoRes.data.regeocode) {\r\n\t\t\t\t\n              address = geoRes.data.regeocode.formatted_address || geoRes.data.regeocode.addressComponent.province;\n            } else {\n              address = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;\n            }\n            \n            // 更新状态\n            currentAddress.value = address;\n            location.value = { latitude, longitude };\n            \n            // 触发事件\n            emit('change', address, { latitude, longitude });\n          },\n          fail: () => {\n            const address = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;\n            currentAddress.value = address;\n            location.value = { latitude, longitude };\n            emit('change', address, { latitude, longitude });\n          },\n          complete: () => {\n            isLoading.value = false;\n          }\n        });\n      },\n      fail: (err) => {\n        uni.__f__('error','at components/location-picker.vue:101','获取位置信息失败', err);\n        currentAddress.value = props.placeholder || '选择位置';\n        uni.showToast({\n          title: '获取位置失败',\n          icon: 'none'\n        });\n        isLoading.value = false;\n      }\n    });\n  } catch (error) {\n    uni.__f__('error','at components/location-picker.vue:111','获取位置信息失败', error);\n    currentAddress.value = props.placeholder || '选择位置';\n    uni.showToast({\n      title: '获取位置失败',\n      icon: 'none'\n    });\n    isLoading.value = false;\n  }\n};\n\nconst chooseLocation = () => {\n  if (props.disabled) return;\n  \n  // 使用UniApp的地图选择位置功能\n  uni.chooseLocation({\n    success: (res) => {\n      currentAddress.value = res.name || res.address;\n      location.value = {\n        latitude: res.latitude,\n        longitude: res.longitude\n      };\n      emit('change', res.name || res.address, location.value);\n    },\n    fail: (err) => {\n      uni.__f__('error','at components/location-picker.vue:135','选择位置失败', err);\n      // 处理用户拒绝授权的情况\n      if (err.errMsg && (err.errMsg.includes('fail auth deny') || err.errMsg.includes('fail authorize'))) {\n        uni.showModal({\n          title: '权限拒绝',\n          content: '请在设置中允许使用位置权限以正常使用地图功能',\n          showCancel: true,\n          confirmText: '去设置',\n          success: (modalRes) => {\n            if (modalRes.confirm) {\n              // 打开应用设置页面\n              uni.openSetting({\n                success: (settingRes) => {\n                  if (settingRes.authSetting['scope.userLocation']) {\n                    // 用户打开了位置权限，重新尝试获取位置\n                    chooseLocation();\n                  }\n                }\n              });\n            }\n          }\n        });\n      } else {\n        uni.showToast({\n          title: '选择位置失败',\n          icon: 'none'\n        });\n      }\n    }\n  });\n};\n\n// 生命周期\nonMounted(() => {\n  // 自动获取位置\n  handleLocation();\n});\n</script>\n\n\n<style scoped>\n.location-picker {\n  width: 100%;\n}\n\n.location-content {\n  display: flex;\n  align-items: center;\n}\n\n.location-icon {\n  margin-right: 12rpx;\n}\n\n.location-text {\n  font-size: 28rpx;\n  color: #333;\n}\n\n.loading-icon {\n  width: 40rpx;\n  height: 40rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n</style>","import Component from 'D:/demo/uniapp_share/minprogram_share/components/location-picker.vue'\nwx.createComponent(Component)"],"names":["ref","uni","onMounted"],"mappings":"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"}