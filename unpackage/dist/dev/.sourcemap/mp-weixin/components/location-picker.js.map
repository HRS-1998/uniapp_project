{"version":3,"file":"location-picker.js","sources":["components/location-picker.vue","C:/Users/ctwl/Desktop/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovZGVtby91bmlhcHBfc2hhcmUvbWlucHJvZ3JhbV9zaGFyZS9jb21wb25lbnRzL2xvY2F0aW9uLXBpY2tlci52dWU"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref, onMounted } from 'vue';\n\n// Props定义\nconst props = defineProps<{\n  showIcon?: boolean;\n  placeholder?: string;\n  disabled?: boolean;\n}>();\n\n// Emits定义\nconst emit = defineEmits<{\n  'change': [address: string, location: { latitude: number; longitude: number }];\n}>();\n\n// 响应式数据\nconst currentAddress = ref('定位中...');\nconst location = ref<{ latitude: number; longitude: number }>({\n  latitude: 0,\n  longitude: 0\n});\nconst isLoading = ref(false);\n\n// 方法定义\nconst checkLocationAuth = () => {\n  return new Promise((resolve, reject) => {\n    uni.getSetting({\n      success: (res) => {\n        if (res.authSetting['scope.userLocation']) {\n          resolve(true);\n        } else {\n          reject(false);\n        }\n      },\n      fail: (err) => {\n        reject(err);\n      }\n    });\n  });\n};\n\nconst requestLocationAuth = () => {\n  return new Promise((resolve, reject) => {\n    uni.authorize({\n      scope: 'scope.userLocation',\n      success: () => {\n        resolve(true);\n      },\n      fail: (err) => {\n        reject(err);\n      }\n    });\n  });\n};\n\nconst getLocationInfo = () => {\n  return new Promise((resolve, reject) => {\n    uni.getLocation({\n      type: 'gcj02',\n      altitude: true,\n      success: (res) => {\n        resolve(res);\n      },\n      fail: (err) => {\n        reject(err);\n      }\n    });\n  });\n};\n\nconst reverseGeocode = async (latitude: number, longitude: number) => {\n  try {\n    // 在实际项目中，这里可以调用地图服务的逆地理编码接口\n    // 这里使用模拟数据\n    return {\n      address: '北京市朝阳区',\n      formattedAddress: '北京市朝阳区某某街道某某号'\n    };\n  } catch (error) {\n    uni.__f__('error','at components/location-picker.vue:80','逆地理编码失败', error);\n    return {\n      address: `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`,\n      formattedAddress: `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`\n    };\n  }\n};\n\nconst handleLocation = async () => {\n  if (props.disabled || isLoading.value) return;\n  \n  isLoading.value = true;\n  try {\n    // 检查定位权限\n    try {\n      await checkLocationAuth();\n    } catch {\n      try {\n        await requestLocationAuth();\n      } catch {\n        uni.showModal({\n          title: '提示',\n          content: '请在设置中打开位置权限',\n          confirmText: '去设置',\n          success: (res) => {\n            if (res.confirm) {\n              uni.openSetting();\n            }\n          }\n        });\n        return;\n      }\n    }\n    \n    // 获取位置信息\n    const locationRes = await getLocationInfo();\n    const { latitude, longitude } = locationRes as any;\n    \n    // 逆地理编码\n    const addressInfo = await reverseGeocode(latitude, longitude);\n    \n    // 更新状态\n    currentAddress.value = addressInfo.address;\n    location.value = { latitude, longitude };\n    \n    // 触发事件\n    emit('change', addressInfo.address, { latitude, longitude });\n  } catch (error) {\n    uni.__f__('error','at components/location-picker.vue:128','获取位置信息失败', error);\n    currentAddress.value = props.placeholder || '选择位置';\n    uni.showToast({\n      title: '获取位置失败',\n      icon: 'none'\n    });\n  } finally {\n    isLoading.value = false;\n  }\n};\n\nconst chooseLocation = () => {\n  if (props.disabled) return;\n  \n  uni.chooseLocation({\n    success: (res) => {\n      currentAddress.value = res.name;\n      location.value = {\n        latitude: res.latitude,\n        longitude: res.longitude\n      };\n      emit('change', res.name, location.value);\n    },\n    fail: (err) => {\n      uni.__f__('error','at components/location-picker.vue:152','选择位置失败', err);\n      if (err.errMsg.includes('auth deny')) {\n        uni.showModal({\n          title: '提示',\n          content: '请在设置中打开位置权限',\n          confirmText: '去设置',\n          success: (res) => {\n            if (res.confirm) {\n              uni.openSetting();\n            }\n          }\n        });\n      }\n    }\n  });\n};\n\n// 生命周期\nonMounted(() => {\n  // 自动获取位置\n  handleLocation();\n});\n</script>\n\n<template>\n  <view class=\"location-picker\" @tap=\"chooseLocation\">\n    <van-cell :disabled=\"disabled\">\n      <template #title>\n        <view class=\"location-content\">\n          <van-icon \n            v-if=\"showIcon !== false\" \n            name=\"location-o\" \n            size=\"32rpx\" \n            color=\"#e94359\" \n            class=\"location-icon\"\n          />\n          <text class=\"location-text\">{{ currentAddress || (placeholder || '选择位置') }}</text>\n        </view>\n      </template>\n      <template #right-icon>\n        <view v-if=\"isLoading\" class=\"loading-icon\">\n          <van-loading type=\"spinner\" size=\"20rpx\" color=\"#999\" />\n        </view>\n        <van-icon v-else name=\"arrow\" size=\"28rpx\" color=\"#999\" />\n      </template>\n    </van-cell>\n  </view>\n</template>\n\n<style scoped>\n.location-picker {\n  width: 100%;\n}\n\n.location-content {\n  display: flex;\n  align-items: center;\n}\n\n.location-icon {\n  margin-right: 12rpx;\n}\n\n.location-text {\n  font-size: 28rpx;\n  color: #333;\n}\n\n.loading-icon {\n  width: 40rpx;\n  height: 40rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n</style>","import Component from 'D:/demo/uniapp_share/minprogram_share/components/location-picker.vue'\nwx.createComponent(Component)"],"names":["ref","uni","onMounted"],"mappings":";;;;;;;;;;;;;;;;;AAIA,UAAM,QAAQ;AAOd,UAAM,OAAO;AAKP,UAAA,iBAAiBA,kBAAI,QAAQ;AACnC,UAAM,WAAWA,cAAAA,IAA6C;AAAA,MAC5D,UAAU;AAAA,MACV,WAAW;AAAA,IAAA,CACZ;AACK,UAAA,YAAYA,kBAAI,KAAK;AAG3B,UAAM,oBAAoB,MAAM;AAC9B,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCC,sBAAAA,MAAI,WAAW;AAAA,UACb,SAAS,CAAC,QAAQ;AACZ,gBAAA,IAAI,YAAY,oBAAoB,GAAG;AACzC,sBAAQ,IAAI;AAAA,YAAA,OACP;AACL,qBAAO,KAAK;AAAA,YACd;AAAA,UACF;AAAA,UACA,MAAM,CAAC,QAAQ;AACb,mBAAO,GAAG;AAAA,UACZ;AAAA,QAAA,CACD;AAAA,MAAA,CACF;AAAA,IAAA;AAGH,UAAM,sBAAsB,MAAM;AAChC,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,SAAS,MAAM;AACb,oBAAQ,IAAI;AAAA,UACd;AAAA,UACA,MAAM,CAAC,QAAQ;AACb,mBAAO,GAAG;AAAA,UACZ;AAAA,QAAA,CACD;AAAA,MAAA,CACF;AAAA,IAAA;AAGH,UAAM,kBAAkB,MAAM;AAC5B,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCA,sBAAAA,MAAI,YAAY;AAAA,UACd,MAAM;AAAA,UACN,UAAU;AAAA,UACV,SAAS,CAAC,QAAQ;AAChB,oBAAQ,GAAG;AAAA,UACb;AAAA,UACA,MAAM,CAAC,QAAQ;AACb,mBAAO,GAAG;AAAA,UACZ;AAAA,QAAA,CACD;AAAA,MAAA,CACF;AAAA,IAAA;AAGG,UAAA,iBAAiB,OAAO,UAAkB,cAAsB;AAChE,UAAA;AAGK,eAAA;AAAA,UACL,SAAS;AAAA,UACT,kBAAkB;AAAA,QAAA;AAAA,eAEb,OAAO;AACdA,sBAAA,MAAI,MAAM,SAAQ,wCAAuC,WAAW,KAAK;AAClE,eAAA;AAAA,UACL,SAAS,GAAG,SAAS,QAAQ,CAAC,CAAC,KAAK,UAAU,QAAQ,CAAC,CAAC;AAAA,UACxD,kBAAkB,GAAG,SAAS,QAAQ,CAAC,CAAC,KAAK,UAAU,QAAQ,CAAC,CAAC;AAAA,QAAA;AAAA,MAErE;AAAA,IAAA;AAGF,UAAM,iBAAiB,YAAY;AAC7B,UAAA,MAAM,YAAY,UAAU;AAAO;AAEvC,gBAAU,QAAQ;AACd,UAAA;AAEE,YAAA;AACF,gBAAM,kBAAkB;AAAA,QAAA,QAClB;AACF,cAAA;AACF,kBAAM,oBAAoB;AAAA,UAAA,QACpB;AACNA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,SAAS;AAAA,cACT,aAAa;AAAA,cACb,SAAS,CAAC,QAAQ;AAChB,oBAAI,IAAI,SAAS;AACfA,gCAAA,MAAI,YAAY;AAAA,gBAClB;AAAA,cACF;AAAA,YAAA,CACD;AACD;AAAA,UACF;AAAA,QACF;AAGM,cAAA,cAAc,MAAM;AACpB,cAAA,EAAE,UAAU,UAAc,IAAA;AAGhC,cAAM,cAAc,MAAM,eAAe,UAAU,SAAS;AAG5D,uBAAe,QAAQ,YAAY;AAC1B,iBAAA,QAAQ,EAAE,UAAU,UAAU;AAGvC,aAAK,UAAU,YAAY,SAAS,EAAE,UAAU,WAAW;AAAA,eACpD,OAAO;AACdA,sBAAA,MAAI,MAAM,SAAQ,yCAAwC,YAAY,KAAK;AAC5D,uBAAA,QAAQ,MAAM,eAAe;AAC5CA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AAAA,MAAA,UACD;AACA,kBAAU,QAAQ;AAAA,MACpB;AAAA,IAAA;AAGF,UAAM,iBAAiB,MAAM;AAC3B,UAAI,MAAM;AAAU;AAEpBA,oBAAAA,MAAI,eAAe;AAAA,QACjB,SAAS,CAAC,QAAQ;AAChB,yBAAe,QAAQ,IAAI;AAC3B,mBAAS,QAAQ;AAAA,YACf,UAAU,IAAI;AAAA,YACd,WAAW,IAAI;AAAA,UAAA;AAEjB,eAAK,UAAU,IAAI,MAAM,SAAS,KAAK;AAAA,QACzC;AAAA,QACA,MAAM,CAAC,QAAQ;AACbA,wBAAA,MAAI,MAAM,SAAQ,yCAAwC,UAAU,GAAG;AACvE,cAAI,IAAI,OAAO,SAAS,WAAW,GAAG;AACpCA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,SAAS;AAAA,cACT,aAAa;AAAA,cACb,SAAS,CAAC,QAAQ;AAChB,oBAAI,IAAI,SAAS;AACfA,gCAAA,MAAI,YAAY;AAAA,gBAClB;AAAA,cACF;AAAA,YAAA,CACD;AAAA,UACH;AAAA,QACF;AAAA,MAAA,CACD;AAAA,IAAA;AAIHC,kBAAAA,UAAU,MAAM;AAEC;IAAA,CAChB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3KD,GAAG,gBAAgB,SAAS;"}