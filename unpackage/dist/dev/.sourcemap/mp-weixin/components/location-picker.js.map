{"version":3,"file":"location-picker.js","sources":["components/location-picker.vue","C:/Users/ctwl/Desktop/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovZGVtby91bmlhcHBfc2hhcmUvbWlucHJvZ3JhbV9zaGFyZS9jb21wb25lbnRzL2xvY2F0aW9uLXBpY2tlci52dWU"],"sourcesContent":["\r\n<template>\r\n  <view class=\"location-picker\" @tap=\"chooseLocation\">\r\n    <u-cell :disabled=\"disabled\">\r\n      <template #title>\r\n        <view class=\"location-content\">\r\n       <!--   <van-icon \r\n            v-if=\"showIcon !== false\" \r\n            name=\"location-o\" \r\n            size=\"32rpx\" \r\n            color=\"#e94359\" \r\n            class=\"location-icon\"\r\n          /> -->\r\n\t\t  <u-icon \r\n            v-if=\"showIcon !== false\" \r\n            name=\"map\" \r\n            size=\"32rpx\" \r\n            color=\"#e94359\" \r\n            class=\"location-icon\"\r\n          />\r\n          <text class=\"location-text\">{{ currentAddress || (placeholder || '选择位置') }}</text>\r\n        </view>\r\n      </template>\r\n      <template #right-icon>\r\n        <view v-if=\"isLoading\" class=\"loading-icon\">\r\n          <u-loading type=\"spinner\" size=\"20rpx\" color=\"#999\" />\r\n        </view>\r\n        <!-- <van-icon v-else name=\"arrow\" size=\"28rpx\" color=\"#999\" /> -->\r\n        <u-icon v-else name=\"arrow-right\" size=\"28rpx\" color=\"#999\" />\r\n      </template>\r\n    </u-cell>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted } from 'vue';\r\n\r\n// Props定义\r\nconst props = defineProps<{\r\n  showIcon?: boolean;\r\n  placeholder?: string;\r\n  disabled?: boolean;\r\n}>();\r\n\r\n// Emits定义\r\nconst emit = defineEmits<{\r\n  'change': [address: string, location: { latitude: number; longitude: number }];\r\n}>();\r\n\r\n// 响应式数据\r\nconst currentAddress = ref('定位中...');\r\nconst location = ref<{ latitude: number; longitude: number }>({\r\n  latitude: 0,\r\n  longitude: 0\r\n});\r\nconst isLoading = ref(false);\r\n\r\nconst handleLocation = async () => {\r\n  if (props.disabled || isLoading.value) return;\r\n  \r\n  isLoading.value = true;\r\n  try {\r\n    // 获取位置信息\r\n    uni.getLocation({\r\n      type: 'gcj02',\r\n\t  highAccuracyExpireTime:3000,\r\n\t  isHighAccuracy:true,\r\n      success: async (res) => {\r\n        const { latitude, longitude } = res;\r\n        uni.request({\r\n          url: 'https://restapi.amap.com/v3/geocode/regeo',\r\n          method: 'GET',\r\n          data: {\r\n            key: 'fdcbd1a63fa5fe1b64ac5b53de5ebb78', // 、高德地图key\r\n            location: `${longitude},${latitude}`,\r\n            extensions: 'base',\r\n            s: 'rsx',\r\n            sdkversion: 'sdkVERSION'\r\n          },\r\n          success: (geoRes: any) => {\r\n            let address = '';\r\n\t\t\tuni.__f__('log','at components/location-picker.vue:82',geoRes)\r\n            if (geoRes.data && geoRes.data.regeocode) {\r\n\t\t\t\t\r\n              address = geoRes.data.regeocode.formatted_address || geoRes.data.regeocode.addressComponent.province;\r\n            } else {\r\n              address = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;\r\n            }\r\n            \r\n            // 更新状态\r\n            currentAddress.value = address;\r\n            location.value = { latitude, longitude };\r\n            \r\n            // 触发事件\r\n            emit('change', address, { latitude, longitude });\r\n          },\r\n          fail: () => {\r\n            const address = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;\r\n            currentAddress.value = address;\r\n            location.value = { latitude, longitude };\r\n            emit('change', address, { latitude, longitude });\r\n          },\r\n          complete: () => {\r\n            isLoading.value = false;\r\n          }\r\n        });\r\n      },\r\n      fail: (err) => {\r\n        uni.__f__('error','at components/location-picker.vue:109','获取位置信息失败', err);\r\n        currentAddress.value = props.placeholder || '选择位置';\r\n        uni.showToast({\r\n          title: '获取位置失败',\r\n          icon: 'none'\r\n        });\r\n        isLoading.value = false;\r\n      }\r\n    });\r\n  } catch (error) {\r\n    uni.__f__('error','at components/location-picker.vue:119','获取位置信息失败', error);\r\n    currentAddress.value = props.placeholder || '选择位置';\r\n    uni.showToast({\r\n      title: '获取位置失败',\r\n      icon: 'none'\r\n    });\r\n    isLoading.value = false;\r\n  }\r\n};\r\n\r\nconst chooseLocation = () => {\r\n  if (props.disabled) return;\r\n  \r\n  // 使用UniApp的地图选择位置功能\r\n  uni.chooseLocation({\r\n    success: (res) => {\r\n      currentAddress.value = res.name || res.address;\r\n      location.value = {\r\n        latitude: res.latitude,\r\n        longitude: res.longitude\r\n      };\r\n      emit('change', res.name || res.address, location.value);\r\n    },\r\n    fail: (err) => {\r\n      uni.__f__('error','at components/location-picker.vue:143','选择位置失败', err);\r\n      // 处理用户拒绝授权的情况\r\n      if (err.errMsg && (err.errMsg.includes('fail auth deny') || err.errMsg.includes('fail authorize'))) {\r\n        uni.showModal({\r\n          title: '权限拒绝',\r\n          content: '请在设置中允许使用位置权限以正常使用地图功能',\r\n          showCancel: true,\r\n          confirmText: '去设置',\r\n          success: (modalRes) => {\r\n            if (modalRes.confirm) {\r\n              // 打开应用设置页面\r\n              uni.openSetting({\r\n                success: (settingRes) => {\r\n                  if (settingRes.authSetting['scope.userLocation']) {\r\n                    // 用户打开了位置权限，重新尝试获取位置\r\n                    chooseLocation();\r\n                  }\r\n                }\r\n              });\r\n            }\r\n          }\r\n        });\r\n      } else {\r\n        uni.showToast({\r\n          title: '选择位置失败',\r\n          icon: 'none'\r\n        });\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\n// 生命周期\r\nonMounted(() => {\r\n  // 自动获取位置\r\n  handleLocation();\r\n});\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.location-picker {\r\n  width: 100%;\r\n}\r\n\r\n.location-content {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.location-icon {\r\n  margin-right: 12rpx;\r\n}\r\n\r\n.location-text {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n}\r\n\r\n.loading-icon {\r\n  width: 40rpx;\r\n  height: 40rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n</style>","import Component from 'D:/demo/uniapp_share/minprogram_share/components/location-picker.vue'\nwx.createComponent(Component)"],"names":["ref","uni","onMounted"],"mappings":"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"}